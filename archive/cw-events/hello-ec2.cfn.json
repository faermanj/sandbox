{
    "Description": "Simplest possible webserver on EC2",
    "Resources": {
        "WebServerSecurityGroup": {
            "Type": "AWS::EC2::SecurityGroup",
            "Properties": {
                "GroupDescription": "allow connections from specified CIDR ranges",
                "SecurityGroupIngress": [{
                    "IpProtocol": "tcp",
                    "FromPort": "80",
                    "ToPort": "80",
                    "CidrIp": "0.0.0.0/0"
                }]
            }
        },

        "WebServer": {
            "Type": "AWS::EC2::Instance",

            "Properties": {
                "InstanceType": "t2.micro",
                "ImageId": "ami-c58c1dd3",
                "SecurityGroups": [{
                    "Ref": "WebServerSecurityGroup"
                }],
                "UserData": {
                    "Fn::Base64": {
                        "Fn::Join": ["\n", [
                            "#cloud-config",
                            "repo_update: true",
                            "repo_upgrade: all",
                            "packages:",
                            "- httpd24",
                            "runcmd:",
                            "- service httpd start",
                            "- chkconfig httpd on",
                            "write_files:",
                            "- content: Hello from cloud-init",
                            "  path: /var/www/html/index.html"
                        ]]
                    }
                }
            }
        }
    }
}
